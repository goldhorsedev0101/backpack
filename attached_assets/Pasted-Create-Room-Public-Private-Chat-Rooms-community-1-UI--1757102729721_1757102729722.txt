Create Room (Public/Private) + ×”×–×× ×ª ××©×ª×ª×¤×™×

×¢×“×›×Ÿ ××ª ×˜××‘ Chat Rooms ×‘Ö¾/community ×›×š:

1) UI â€” ×›×¤×ª×•×¨ â€œCreate Roomâ€

×•×“× ×©×›×¤×ª×•×¨ Create Room ××•×¤×™×¢ ×‘×›×•×ª×¨×ª ×”×¡×™×™×“×‘×¨ ×•×‘Ö¾Empty State (×× ××™×Ÿ ×—×“×¨×™×/×™×© ×©×’×™××”).

×œ×—×™×¦×” ×¢×œ×™×• ×¤×•×ª×—×ª Modal ×™×¦×™×¨×ª ×—×“×¨.

2) Modal ×™×¦×™×¨×ª ×—×“×¨ (×˜×•×¤×¡)

×©×“×•×ª:

Room name (×—×•×‘×”, 2â€“60 ×ª×•×•×™×; ×™×™×—×•×“×™ ×‘××•×¤×Ÿ ×¨×•×¤×£)

Description (××•×¤×¦×™×•× ×œ×™, ×¢×“ 200)

Visibility / Type (×‘×—×™×¨×”: Public / Private)

×× ×§×™×™××ª ×¢××•×“×” type â†’ ×©××•×¨ type='public' | 'private'

×× ××™×Ÿ type ×•×™×© metadata jsonb â†’ ×©××•×¨ metadata->>'type'

Invite participants (×œÖ¾Private ×‘×œ×‘×“):

×× ×™×© Auth: ×©×“×” Users ×¢× autocomplete (××˜×‘×œ×ª users ××• ××§×•×¨ ×§×™×™×) ×œ×‘×—×™×¨×ª 1â€“10 ××©×ª××©×™×.

Guests: ×¨×©×™××ª guest nicknames (×˜×§×¡×˜ ××•×¤×¨×“ ×‘×¤×¡×™×§×™×) â€” ×™×¦×•×¨ ×©×•×¨×•×ª chat_room_members ×¢× guest_name.

You (×”×™×•×¦×¨):

Auth â†’ ×”×•×¡×£ ××•×ª×š ××•×˜×•××˜×™×ª ×›×—×‘×¨ ×—×“×¨ (user_id = auth.uid())

Guest Mode â†’ ×‘×§×©/×§×¨× guest_name ×-localStorage, ×©×“×” ×—×•×‘×” ×× ×—×¡×¨

×•×œ×™×“×¦×™×”:

name ×œ× ×¨×™×§; ×œ× ×—×•×¨×’ ××•×¨×š; ×œ× ×›×•×œ×œ ×ª×•×•×™× ×‘×¢×™×™×ª×™×™×

×× Private â†’ ×—×™×™×‘ ×œ×”×™×•×ª ×œ×¤×—×•×ª ××©×ª×ª×£ ××—×“ × ×•×¡×£ (User ××• Guest)

3) Insert ×œ-Supabase (×œ×œ× ×”×§×©×—×ª ××¤×ª×—×•×ª)

×™×¦×™×¨×ª ×—×“×¨:

const base = { name, description };
const roomPayload = {
  ...base,
  ...(hasColumn('type') ? { type: isPrivate ? 'private' : 'public' } : {}),
  ...(hasJsonColumn('metadata') ? { metadata: { type: isPrivate ? 'private' : 'public' } } : {})
};

const { data: room, error: roomErr } = await supabase
  .from('chat_rooms')
  .insert([roomPayload])
  .select()
  .single();


×”×•×¡×¤×ª ×—×‘×¨×™× (×× ×§×™×™××ª chat_room_members):

×™×•×¦×¨ (Auth/Guest) + ×›×œ ×”××•×–×× ×™× (Users/Guests) ×‘×©××™×œ×ª×ª insert ××—×ª (batch).

×× ××™×Ÿ chat_room_members â€” ×“×œ×’ ×‘×©×§×˜ (×”×—×“×¨ ×¢×“×™×™×Ÿ ×™×•×¤×™×¢ ×›×¦×™×‘×•×¨×™; ×œ×¤×¨×˜×™ ×©××•×¨ ××ª ×”-type ×‘-type/metadata).

×˜×™×¤×•×œ ×‘×©×’×™××•×ª: ×”×¦×’ toast ×‘×¨×•×¨; ×× permission denied â†’ ×”×¤× ×” ×œ-docs/community-rls.md.

4) ×¨×¢× ×•×Ÿ ×•×¤×ª×™×—×”

×œ××—×¨ ×”×¦×œ×—×”:

×¨×¢× ×Ÿ ××ª ×¨×©×™××ª ×”×—×“×¨×™× ×‘×¡×™×™×“×‘×¨ (××• ×”×•×¡×£ ××ª ×”×—×“×¨ ×œ-state).

×‘×—×¨ ×•×¤×ª×— ××ª ×”×—×“×¨ ×”×—×“×© (RoomView).

×”×¦×’ toast â€œRoom createdâ€.

5) Empty/Error states

×× ×˜×¢×™× ×ª ×—×“×¨×™× × ×›×©×œ×” â†’ ×”×¦×’ â€œUnable to load chat roomsâ€ + Retry.

×× ××™×Ÿ ×—×“×¨×™× â†’ Empty State ×¢× ×›×¤×ª×•×¨ Create Room.

××œ ×ª×§×¨×™×¡ ×× ×—×¡×¨×•×ª ×¢××•×“×•×ª â€” ×‘×§×© ×¨×§ ×¢××•×“×•×ª ×§×™×™××•×ª ×‘-select() (×œ××©×œ: id,name,description,created_at,type,metadata ×›×©××¤×©×¨).

6) Private visibility (UI ×‘×œ×‘×“)

×œ×™×“ ×©× ×—×“×¨ ×¤×¨×˜×™ ×‘×¡×™×™×“×‘×¨ ×”×¦×’ ××™×™×§×•×Ÿ ğŸ”’/Badge â€œPrivateâ€.

×‘-RoomView: ×× private â†’ ×”×¦×’ Tooltip â€œOnly invited members can see messagesâ€.

7) Invite to DM (××”×•×“×¢×” ×§×™×™××ª)

×‘-MessageItem ×”×•×¡×£ ×ª×¤×¨×™×˜ â‹¯ ×¢× Invite to DM:

With Auth â†’ ×¤×ª×—/×¦×•×¨ DM ××•×œ user_id ×©×œ ×”××—×‘×¨;

Guest â†’ ×¤×ª×—/×¦×•×¨ DM ××•×œ author_name.

×œ××—×¨ ×™×¦×™×¨×”/××™×ª×•×¨ ×”×—×“×¨ â†’ × ×•×•×˜ ×œ-DM ×•×”×¦×’ toast â€œDM opened with Xâ€.

8) Guest Mode

×× ××™×Ÿ Auth, ×•×“× ×©×‘×›×œ ×™×¦×™×¨×”/×©×œ×™×—×ª ×”×•×“×¢×” ×§×™×™× guest_name ×‘-localStorage; ×× ×—×¡×¨ â€” ×‘×§×© ×‘×¤×•×¤-××¤ ×§×˜×Ÿ.

×‘-Private room ×¢× Guests ×‘×œ×‘×“ â€” ×™×¦×™×¨×” ×ª×¢×‘×•×“ ×’× ×‘×œ×™ users, ×‘×××¦×¢×•×ª chat_room_members.guest_name.

9) RLS/Policies â€” ×ª×™×¢×•×“ × ×œ×•×•×” (×œ× ×œ×”×¨×™×¥ ××•×˜×•××˜×™×ª)

×¢×“×›×Ÿ/×¦×•×¨ docs/community-rls.md ×¢× SQL ×œ×“×•×’××”:

DEV (×¤×ª×•×— ×œ×›×ª×™×‘×” ×‘×¡×™×¡×™×ª): create policy ... for insert with check (true) ×¢×œ chat_rooms, chat_room_members.

PROD:

×™×¦×™×¨×ª ×—×“×¨: auth.uid() ×‘×œ×‘×“;

chat_room_members: insert ×¨×§ ×¢"×™ ×‘×¢×œ ×”×—×“×¨;

messages: select/insert ×¨×§ ×œ×—×‘×¨×™ ×—×“×¨;

Storage (×× ×™×© ×¦×™×¨×•×¤×™×): ×§×¨×™××”/×›×ª×™×‘×” ×œ×¤×™ ×—×‘×¨×•×ª ×‘×—×“×¨.

10) ×§×‘×œ×” (Acceptance)

×›×¤×ª×•×¨ Create Room ×–××™×Ÿ; Modal × ×¤×ª×—.

××¤×©×¨ ×œ×™×¦×•×¨ Public ××• Private; ×‘-Private × ×™×ª×Ÿ ×œ×”×–××™×Ÿ Users/Guests.

× ×•×¦×¨×ª ×¨×©×•××” ×‘-chat_rooms (×¢× type/metadata) + (×× ×§×™×™××ª) ×¨×©×•××•×ª ×‘-chat_room_members ×œ×›×œ ×”××©×ª×ª×¤×™×.

×”×¡×™×™×“×‘×¨ ××ª×¢×“×›×Ÿ ××™×“, ×•×”×—×“×¨ ×”×—×“×© × ×¤×ª×—.

Invite-to-DM ×¤×¢×™×œ ××ª×¤×¨×™×˜ ×”×•×“×¢×”.

××™×Ÿ ×”×§×©×—×ª ××¤×ª×—×•×ª; ×©×™××•×© ×‘-ENV ×‘×œ×‘×“.

××™×Ÿ ×©×‘×™×¨×” ×©×œ Tabs ××—×¨×™×.

Commit ×‘×¡×™×•×:
feat(community): Create Room modal (public/private) with invitations + sidebar refresh & auto-open; Invite-to-DM